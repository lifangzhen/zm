<?xml version="1.0"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" 
    "http://www.ibatis.com/dtd/sql-map-2.dtd">
    
<sqlMap namespace="Msg_SqlMap">
    
    <typeAlias alias="zmMsg" type="com.lun.mlm.model.ZmMsg"/>
	<typeAlias alias="zmBanner" type="com.lun.mlm.model.ZmBanner"/>
	<typeAlias alias="zmUser" type="com.lun.mlm.model.ZmUser"/>

	<insert id="addZmUser" parameterClass="zmUser">
		INSERT INTO zm_user (
		id,
		open_id,
		name,
		head_img,
		sex,
		area,
		phone,
		create_at,
		update_at
		)
		VALUES
		(#id#,
		#open_id#,
		#name#,
		#head_img#,
		#sex#,
		#area#,
		#phone#,
		NOW(),
		NOW()
		)
	</insert>

	<select id="getUserByOpenId" resultClass="zmUser">
		SELECT * FROM zm_user m
		WHERE m.open_id = #openId#
	</select>

	<select id="listBanner"  resultClass="zmBanner">
		SELECT * FROM zm_banner m
		WHERE m.store_id = #storeId#
	</select>
    
    <select id="list"  resultClass="zmMsg">
    	SELECT * FROM zm_msg m
		WHERE m.store_id = #storeId#
		<isNotEmpty property="tableId">
			AND m.table_id = #tableId#
		</isNotEmpty>
        ORDER BY m.create_at DESC
		<isNotEmpty property="start">
			LIMIT #start#, #end#
		</isNotEmpty>
    </select>
    
</sqlMap>
